# **Complete Arduino Robot Car Code Explanation**

## üìã **PROJECT OVERVIEW**
This program creates a multi-functional Arduino robot car with **three operation modes**:
1. **Obstacle Avoidance** - Autonomous navigation using ultrasonic sensor
2. **Bluetooth Control** - Manual remote control via smartphone
3. **Voice Control** - Voice commands via smartphone

---

## üîß **CODE EXPLANATION - SECTION BY SECTION**

### **SECTION 1: LIBRARIES AND PIN DEFINITIONS**

arduino
/*obstacle avoiding, Bluetooth control, voice control robot car.
   Home Page
*/

// 1. Include necessary libraries
#include <Servo.h>        // Library to control servo motor for sensor scanning
#include <AFMotor.h>      // Library to control L293D motor driver shield

// 2. Define hardware pin connections and constants
#define Echo A0           // Ultrasonic sensor ECHO pin connected to Arduino A0
#define Trig A1           // Ultrasonic sensor TRIG pin connected to Arduino A1
#define motor 10          // Servo motor signal pin connected to digital pin 10
#define Speed 170         // Motor speed value (range: 0-255, 170 = medium speed)
#define spoint 103        // Servo motor center position (in degrees, 103 = centered)


**What this section does:**
- **Includes libraries** needed to control specific hardware components
- **Defines constants** that make the code easier to read and modify
- **Maps physical pins** to logical names for clarity

---

### **SECTION 2: VARIABLE DECLARATIONS**
arduino
// 3. Declare variables for program operation
char value;              // Stores incoming character from Bluetooth (F, B, L, R, S, etc.)
int distance;            // Stores distance measured by ultrasonic sensor (in centimeters)
int Left;                // Stores distance measurement when looking left
int Right;               // Stores distance measurement when looking right
int L = 0;               // Temporary variable for left distance in obstacle mode
int R = 0;               // Temporary variable for right distance in obstacle mode
int L1 = 0;              // Additional variable (currently not used in the code)
int R1 = 0;              // Additional variable (currently not used in the code)


**Purpose of these variables:**
- `value` - Communication between smartphone and Arduino
- `distance` - Measures how close obstacles are
- `Left`, `Right`, `L`, `R` - Store distance readings for decision making
- `L1`, `R1` - Reserved for future enhancements

---

### **SECTION 3: HARDWARE OBJECT CREATION**
arduino
// 4. Create objects to control hardware components
Servo servo;                      // Create servo object to control the servo motor
AF_DCMotor M1(1);                 // Create motor object for Motor 1 (connected to port 1)
AF_DCMotor M2(2);                 // Create motor object for Motor 2 (connected to port 2)
AF_DCMotor M3(3);                 // Create motor object for Motor 3 (connected to port 3)
AF_DCMotor M4(4);                 // Create motor object for Motor 4 (connected to port 4)


**Hardware Layout:**
```
Robot Motor Configuration:
   [M1] Front Left        [M2] Front Right
   [M3] Rear Left         [M4] Rear Right


---

### **SECTION 4: SETUP FUNCTION - INITIALIZATION**

arduino
// 5. Setup function - runs once when Arduino starts
void setup() {
  Serial.begin(9600);           // Start serial communication at 9600 baud rate
  
  pinMode(Trig, OUTPUT);        // Set Trig pin as OUTPUT (sends ultrasonic pulses)
  pinMode(Echo, INPUT);         // Set Echo pin as INPUT (receives ultrasonic echoes)
  
  servo.attach(motor);          // Attach servo to the defined pin (pin 10)
  
  // Set initial speed for all four motors
  M1.setSpeed(Speed);           // Motor 1 speed = 170
  M2.setSpeed(Speed);           // Motor 2 speed = 170
  M3.setSpeed(Speed);           // Motor 3 speed = 170
  M4.setSpeed(Speed);           // Motor 4 speed = 170
}


**What happens in setup():**
- **Serial communication** begins for Bluetooth data transfer
- **Ultrasonic sensor pins** are configured correctly
- **Servo motor** is connected and ready
- **All motors** are set to the same initial speed

---

### **SECTION 5: MAIN LOOP - MODE SELECTION**

arduino
// 6. Main loop function - runs continuously
void loop() {
  // IMPORTANT: Uncomment ONLY ONE function at a time
  //Obstacle();           // Uncomment for Autonomous Obstacle Avoidance Mode
  //Bluetoothcontrol();   // Uncomment for Bluetooth Remote Control Mode
  //voicecontrol();       // Uncomment for Voice Command Control Mode
}


**How to use:**
- Remove `//` before **ONE** function name to activate that mode
- The robot can only run **ONE mode at a time**
- Example: `Obstacle();` (no `//`) activates obstacle avoidance

---

### **SECTION 6: BLUETOOTH CONTROL FUNCTION**

```arduino
// 7. Bluetooth Control Function - for manual remote control
void Bluetoothcontrol() {
  // Check if Bluetooth data is available
  if (Serial.available() > 0) {
    value = Serial.read();       // Read the incoming character from smartphone
    Serial.println(value);       // Send character back for debugging (optional)
  }
  
  // Control robot based on received character
  if (value == 'F') {            // 'F' received ‚Üí Move FORWARD
    forward();
  } else if (value == 'B') {     // 'B' received ‚Üí Move BACKWARD
    backward();
  } else if (value == 'L') {     // 'L' received ‚Üí Turn LEFT
    left();
  } else if (value == 'R') {     // 'R' received ‚Üí Turn RIGHT
    right();
  } else if (value == 'S') {     // 'S' received ‚Üí STOP all motors
    Stop();
  }
}
```

**Bluetooth Command Mapping:**
- `F` = Forward
- `B` = Backward
- `L` = Left turn
- `R` = Right turn
- `S` = Stop

---

### **SECTION 7: OBSTACLE AVOIDANCE FUNCTION**

```arduino
// 8. Obstacle Avoidance Function - autonomous navigation
void Obstacle() {
  // Measure distance to obstacle in front
  distance = ultrasonic();
  
  // If obstacle is within 12cm
  if (distance <= 12) {
    Stop();                // 1. Stop immediately
    backward();            // 2. Move backward briefly (100ms)
    delay(100);
    Stop();                // 3. Stop again
    
    // 4. Check left side distance
    L = leftsee();         // Turn servo left (180¬∞) and measure
    servo.write(spoint);   // Return servo to center (103¬∞)
    delay(800);            // Wait for servo movement
    
    // 5. Check right side distance
    R = rightsee();        // Turn servo right (20¬∞) and measure
    servo.write(spoint);   // Return servo to center (103¬∞)
    
    // 6. Decide which direction has more space
    if (L < R) {           // More space on RIGHT side
      right();             // Turn RIGHT
      delay(500);          // Turn for 500 milliseconds
      Stop();
      delay(200);
    } else if (L > R) {    // More space on LEFT side
      left();              // Turn LEFT
      delay(500);          // Turn for 500 milliseconds
      Stop();
      delay(200);
    }
  } else {
    forward();             // No obstacle detected, keep moving forward
  }
}


**Autonomous Decision Logic:**
```
1. Check front distance
2. If ‚â§12cm: Stop ‚Üí Move back ‚Üí Check left ‚Üí Check right
3. Compare left vs right distances
4. Turn toward MORE space
5. If >12cm: Continue forward
```

---

### **SECTION 8: VOICE CONTROL FUNCTION**

arduino
// 9. Voice Control Function - voice command operation
void voicecontrol() {
  // Check if voice command data is available
  if (Serial.available() > 0) {
    value = Serial.read();     // Read the incoming character
    Serial.println(value);     // Echo for debugging
    
    // Execute command based on special character
    if (value == '^') {        // '^' = FORWARD command
      forward();
    } else if (value == '-') { // '-' = BACKWARD command
      backward();
    } else if (value == '<') { // '<' = LEFT command
      L = leftsee();           // First check left side distance
      servo.write(spoint);     // Return servo to center
      if (L >= 10) {           // If at least 10cm space
        left();                // Turn left
        delay(500);
        Stop();
      } else if (L < 10) {     // If less than 10cm space
        Stop();                // Don't turn, just stop (safety)
      }
    } else if (value == '>') { // '>' = RIGHT command
      R = rightsee();          // First check right side distance
      servo.write(spoint);     // Return servo to center
      if (R >= 10) {           // If at least 10cm space
        right();               // Turn right
        delay(500);
        Stop();
      } else if (R < 10) {     // If less than 10cm space
        Stop();                // Don't turn, just stop (safety)
      }
    } else if (value == '*') { // '*' = STOP command
      Stop();
    }
  }
}
```

**Voice Command Safety Feature:**
- Before turning left/right, **checks if enough space exists** (‚â•10cm)
- If insufficient space, **robot stops** instead of turning
- Prevents collisions during voice control

**Voice Command Mapping:**
- `^` = Forward
- `-` = Backward
- `<` = Left (with safety check)
- `>` = Right (with safety check)
- `*` = Stop

---

### **SECTION 9: ULTRASONIC DISTANCE FUNCTION**

arduino
// 10. Ultrasonic Sensor Function - measures distance
int ultrasonic() {
  // Send 10 microsecond ultrasonic pulse
  digitalWrite(Trig, LOW);
  delayMicroseconds(4);
  digitalWrite(Trig, HIGH);
  delayMicroseconds(10);
  digitalWrite(Trig, LOW);
  
  // Measure echo return time
  long t = pulseIn(Echo, HIGH);
  
  // Convert time to distance in centimeters
  // Formula: distance = (time in microseconds) / 29 / 2
  // 29 = speed of sound conversion (340 m/s ‚âà 29 cm/ms)
  // √∑2 because sound travels to object AND back
  long cm = t / 29 / 2;
  
  return cm;  // Return distance in cm
}


**How ultrasonic sensor works:**
1. Send 10¬µs pulse from TRIG pin
2. Sound travels, hits object, returns
3. Measure time for echo to return
4. Calculate: `distance = (time √ó speed of sound) √∑ 2`

---

### **SECTION 10: MOVEMENT FUNCTIONS**

arduino
// 11. Forward Movement - all 4 motors rotate forward
void forward() {
  M1.run(FORWARD);   // Front Left ‚Üí Forward
  M2.run(FORWARD);   // Front Right ‚Üí Forward
  M3.run(FORWARD);   // Rear Left ‚Üí Forward
  M4.run(FORWARD);   // Rear Right ‚Üí Forward
}

// 12. Backward Movement - all 4 motors rotate backward
void backward() {
  M1.run(BACKWARD);  // Front Left ‚Üí Backward
  M2.run(BACKWARD);  // Front Right ‚Üí Backward
  M3.run(BACKWARD);  // Rear Left ‚Üí Backward
  M4.run(BACKWARD);  // Rear Right ‚Üí Backward
}

// 13. Right Turn - left motors backward, right motors forward
void right() {
  M1.run(BACKWARD);  // Front Left ‚Üí Backward
  M2.run(BACKWARD);  // Front Right ‚Üí Backward
  M3.run(FORWARD);   // Rear Left ‚Üí Forward
  M4.run(FORWARD);   // Rear Right ‚Üí Forward
}

// 14. Left Turn - right motors backward, left motors forward
void left() {
  M1.run(FORWARD);   // Front Left ‚Üí Forward
  M2.run(FORWARD);   // Front Right ‚Üí Forward
  M3.run(BACKWARD);  // Rear Left ‚Üí Backward
  M4.run(BACKWARD);  // Rear Right ‚Üí Backward
}

// 15. Stop - release/stop all motors
void Stop() {
  M1.run(RELEASE);   // Front Left ‚Üí Stop
  M2.run(RELEASE);   // Front Right ‚Üí Stop
  M3.run(RELEASE);   // Rear Left ‚Üí Stop
  M4.run(RELEASE);   // Rear Right ‚Üí Stop
}


**Motor Control Logic:**
- **FORWARD**: All motors same direction
- **BACKWARD**: All motors reverse direction
- **RIGHT TURN**: Left side goes backward, right side goes forward (pivot turn)
- **LEFT TURN**: Right side goes backward, left side goes forward (pivot turn)
- **STOP**: All motors released/stopped

---

### **SECTION 11: SERVO SCANNING FUNCTIONS**

arduino
// 16. Look Right Function - turn servo right and measure
int rightsee() {
  servo.write(20);           // Turn servo to 20¬∞ (looking right)
  delay(800);                // Wait for servo to reach position
  Left = ultrasonic();       // Measure distance (actually measures left side when looking right)
  return Left;               // Return measured distance
}

// 17. Look Left Function - turn servo left and measure
int leftsee() {
  servo.write(180);          // Turn servo to 180¬∞ (looking left)
  delay(800);                // Wait for servo to reach position
  Right = ultrasonic();      // Measure distance (actually measures right side when looking left)
  return Right;              // Return measured distance
}


**Servo Scanning Positions:**
- **`rightsee()`**: Servo at 20¬∞ ‚Üí "looks right" but measures left space
- **`leftsee()`**: Servo at 180¬∞ ‚Üí "looks left" but measures right space
- **800ms delay**: Allows servo to physically move before measuring



## üéØ **KEY PROGRAM FEATURES**

### **1. Modular Design**
- Three independent functions for different modes
- Easy to enable/disable modes by (un)commenting
- Clean separation of logic

### **2. Safety Features**
- Voice mode checks space before turning
- Obstacle mode stops and reverses before deciding
- Distance thresholds prevent collisions

### **3. Configurable Parameters**
arduino
#define Speed 170      // Change motor speed (0-255)
#define spoint 103     // Adjust servo center position
if (distance <= 12)    // Change obstacle detection distance (12cm)
if (L >= 10)           // Change minimum turning space (10cm)


### **4. Debugging Support**
- `Serial.println(value)` shows received commands
- Easy to monitor Bluetooth communication
- Helps troubleshoot connection issues

---

## üîß **HOW TO USE THIS PROGRAM**

### **Step 1: Select Mode**
arduino
void loop() {
  // Uncomment ONLY ONE line below:
  Obstacle();           // Autonomous mode
  //Bluetoothcontrol(); // Bluetooth mode  
  //voicecontrol();     // Voice mode
}


### **Step 2: Upload Code**
1. **Disconnect Bluetooth TX/RX wires** from Arduino
2. Upload code to Arduino
3. **Reconnect Bluetooth wires**

### **Step 3: Control Robot**
- **Obstacle Mode**: Powers on and navigates automatically
- **Bluetooth Mode**: Use smartphone app with buttons
- **Voice Mode**: Use smartphone app with voice commands

---

## ‚ö†Ô∏è **IMPORTANT NOTES**

1. **Only one mode can be active at a time**
2. **Bluetooth must be disconnected during code upload**
3. **Battery power affects motor performance**
4. **Ultrasonic sensor works best with solid objects**
5. **Servo may need calibration for center position**

---

## üìà **PROGRAM FLOW SUMMARY**

```
Start
  ‚Üì
Setup: Initialize hardware
  ‚Üì
Loop: Check selected mode
  ‚Üì
Mode Execution:
  ‚Ä¢ Obstacle(): Scan ‚Üí Decide ‚Üí Move
  ‚Ä¢ Bluetoothcontrol(): Read ‚Üí Execute command
  ‚Ä¢ Voicecontrol(): Listen ‚Üí Check safety ‚Üí Execute
  ‚Üì
Repeat continuously
```
